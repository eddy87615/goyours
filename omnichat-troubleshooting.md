# OmniChat 通知問題排查指南

## 🎯 目前狀況
✅ **API 連線成功** - 收到 HTTP 200 狀態碼  
✅ **收到 triggerId** - OmniChat 已接受請求  
❌ **沒有收到實際通知** - LINE 沒有收到訊息  

## 🔍 問題診斷步驟

### 1. 檢查 OmniChat 後台發送紀錄
- 登入 [OmniChat 後台](https://app.omnichat.ai)
- 進入「通知管理」或「發送紀錄」
- 搜尋最近的 Trigger ID
- 查看發送狀態和錯誤訊息

### 2. 驗證通知模板設定
**Setting ID**: `68527dfb060eab724d2c4d9a`

檢查項目：
- [ ] 模板是否存在且已啟用
- [ ] 模板類型是否設為「LINE 通知」(不是 SMS)
- [ ] 模板變數是否正確配置

我們發送的變數：
```json
{
  "name": "使用者姓名",
  "age": "年齡", 
  "phone": "電話號碼",
  "lineId": "LINE ID",
  "email": "電子郵件",
  "message": "留言內容",
  "submittedAt": "提交時間"
}
```

### 3. 檢查電話號碼綁定
**目標電話**: `0975008716` → `886975008716`

在 OmniChat 後台檢查：
- [ ] 該電話號碼是否已註冊
- [ ] 是否已與 LINE 帳號成功綁定
- [ ] 綁定狀態是否為「已驗證」
- [ ] LINE 帳號是否為活躍狀態

### 4. 驗證 LINE Channel 設定
**Channel ID**: `2007407348`

檢查項目：
- [ ] LINE Channel 是否正常連接
- [ ] Webhook 設定是否正確
- [ ] Channel 是否有發送訊息權限
- [ ] 是否達到發送限制

### 5. 檢查 API 請求格式
確認我們發送的格式符合文檔要求：

```json
{
  "notifications": [
    {
      "platform": "line",
      "channelId": "2007407348",
      "to": "886975008716",
      "settingId": "68527dfb060eab724d2c4d9a",
      "valueMap": { ... }
    }
  ]
}
```

### 6. 測試其他電話號碼
如果有其他已知綁定成功的電話號碼，可以用來測試：
- 是否只有特定號碼有問題
- 或者是整體設定問題

## 🛠️ 可能的解決方案

### 方案 1: 通知模板問題
1. 在 OmniChat 後台重新設定通知模板
2. 確認變數名稱與我們發送的一致
3. 測試模板的發送功能

### 方案 2: 電話號碼綁定問題
1. 重新綁定電話號碼與 LINE 帳號
2. 確認 LINE 帳號設定允許接收通知
3. 檢查是否有封鎖設定

### 方案 3: Channel 權限問題
1. 檢查 LINE Channel 的權限設定
2. 確認 API Token 有足夠的權限
3. 檢查是否達到發送限制

### 方案 4: 聯繫技術支援
提供以下資訊給 OmniChat 技術支援：
- Trigger ID: (從最新測試獲得)
- Channel ID: `2007407348`
- Setting ID: `68527dfb060eab724d2c4d9a`
- 目標電話: `886975008716`
- 問題描述: API 成功但沒收到通知

## 📊 下一步建議
1. **立即檢查** OmniChat 後台的發送紀錄
2. **驗證模板** 設定和變數配置
3. **測試其他號碼** 確認是個別問題或整體問題
4. **聯繫支援** 如果以上步驟無法解決

## 🔔 注意事項
- OmniChat 的通知是異步處理，可能有延遲
- 某些錯誤不會立即回報，需要查看後台紀錄
- 確保 LINE 帳號沒有封鎖該 Channel